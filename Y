if arg_dict.get("train.rays.fixed_random", False):
    N_keep = arg_dict.get("train.rays.samples", 50000)
    total_rays = all_rays_o.shape[0]

    # Génération une seule fois
    if "train.fixed_ray_set" not in arg_dict:
        tf.random.set_seed(42)  # reproductibilité
        indices = tf.random.shuffle(tf.range(total_rays))[:N_keep]
        arg_dict["train.fixed_ray_set"] = {
            'indices': indices,
            'rays_o': tf.gather(all_rays_o, indices),
            'rays_d': tf.gather(all_rays_d, indices),
            'values': tf.gather(all_values, indices)
        }
        if use_view_dirs:
            all_view_dirs = tf.reshape(tf.convert_to_tensor(all_view_dirs), [-1, 2])
            arg_dict["train.fixed_ray_set"]['view_dirs'] = tf.gather(all_view_dirs, indices)
        if use_light_dirs:
            all_light_dirs = tf.reshape(tf.convert_to_tensor(all_light_dirs), [-1, 2])
            arg_dict["train.fixed_ray_set"]['light_dirs'] = tf.gather(all_light_dirs, indices)
    
    # Toujours renvoyer les mêmes rayons
    return arg_dict["train.fixed_ray_set"]
